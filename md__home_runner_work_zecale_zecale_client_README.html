<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Zecale - Reconciling Privacy and Scalability on Smart-Contract Chains: Python client to interact with the Zecale aggregator</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Zecale - Reconciling Privacy and Scalability on Smart-Contract Chains
   &#160;<span id="projectnumber">0.5</span>
   </div>
   <div id="projectbrief">Reference implementation of the Zecale protocol by Clearmatics</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Python client to interact with the Zecale aggregator </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Structure of the directory</h1>
<h2><code>zecale</code></h2>
<div class="fragment"><div class="line">zecale</div>
<div class="line"> |_ api</div>
<div class="line"> |_ cli</div>
<div class="line"> |_ core</div>
<div class="line"> |_ dummy_app</div>
</div><!-- fragment --><p>This directory contains the API code for the Zecale client (<code>api</code>), its backend implementation (<code>core</code>), the code for the client CLI (<code>cli</code>), and the code of a helper CLI for a "dummy application" (<code>dummy_app</code>).</p>
<h2><code><a class="el" href="namespacetest__commands.html">test_commands</a></code></h2>
<p>This directory contains a list of useful commands to help run the tests, as well as some minimal testing scenarios acting as integration tests.</p>
<h2><code>tests</code></h2>
<p>The <code>tests</code> folder contains the unit tests of the <code>zecale</code> package.</p>
<h1>Setup</h1>
<p>Ensure that the following are installed:</p>
<ul>
<li>Python 3.7 (See <code>python --version</code>)</li>
<li><a href="https://docs.python.org/3/library/venv.html#module-venv">venv</a> module.</li>
<li>gcc</li>
</ul>
<p>First, ensure that the Zeth client has been setup as described in the <a href="https://github.com/clearmatics/zeth/blob/master/client/README.md">Zeth client setup documentation</a>. (This step is required since the Zeth client setup process includes some code generation). If this has not already been done, it can be performed as follows (assuming the current working directory is the Zecale repository root): </p><div class="fragment"><div class="line">$ pushd depends/zeth/client</div>
<div class="line">$ python -m venv env</div>
<div class="line">$ source env/bin/activate</div>
<div class="line">(env)$ make setup</div>
<div class="line">(env)$ deactivate</div>
<div class="line">$ popd</div>
</div><!-- fragment --><p>For encapsulation, we suggest creating a Python virtualenv specific to the Zecale client tools. The Zeth client will be installed as an editable package (a reference to, rather than a copy of, the package in <code>depends/zeth/client</code>) in this virtualenv. Setup is performed as follows: </p><div class="fragment"><div class="line">$ cd client</div>
<div class="line">$ python -m venv env</div>
<div class="line">$ source env/bin/activate</div>
<div class="line">(env)$ make setup</div>
</div><!-- fragment --><p>Unless otherwise stated, we assume that all further commands are executed from within the Python virtualenv (indicated by the <code>(env)</code> prefix to the command prompt), and in the <code>client</code> directory. To enter the virtualenv from a new terminal, run the following: </p><div class="fragment"><div class="line">$ source env/bin/activate</div>
</div><!-- fragment --><p>(Alternatively, specify the full path to <code>client/env/bin/activate</code> to execute from outside the <code>client</code> directory).</p>
<h1>Execute unit tests</h1>
<p>Unit tests for the client code can be executed as follows: </p><div class="fragment"><div class="line">(env)$ make check</div>
</div><!-- fragment --><h1>Launch a local Ethereum testnet</h1>
<p>Zecale smart contracts require support for BW6-761 arithmetic, via precompiled contracts. A modified version of ganache-cli (which includes such support) can be launched from a docker image as follows (note that this should be run in its own terminal instance, from the repo root, and does not require the Python virtualenv to be active): </p><div class="fragment"><div class="line">$ depends/zeth/scripts/ganache-start</div>
</div><!-- fragment --><p>(See <a href="https://github.com/clearmatics/zeth/">Zeth</a> for more information)</p>
<h1>Execute testing scripts</h1>
<p>Once the <code>aggregator-server</code> and a custom <code>ganache-cli</code> instance are running, several scripts can be executed to test the CLIs as well as various aspects of the client and the contracts:</p>
<div class="fragment"><div class="line">(env)$ python test_commands/&lt;script-name&gt; &lt;script-arguments&gt;</div>
</div><!-- fragment --><p>for instance: </p><div class="fragment"><div class="line">(env)$ python test_commands/test_bw6_761_groth16_contract.py</div>
</div><!-- fragment --><p>A fuller integration test for the CLIs can also be executed:</p>
<div class="fragment"><div class="line">(env)$ cd ..</div>
<div class="line">(env)$ ./scripts/test-client</div>
</div><!-- fragment --><h1>The <code>zecale</code> command line interface</h1>
<p>The <code>zecale</code> command exposes Zecale operations via a command line interface. A brief description is given in this section. More details are available via <code>zecale --help</code>, and example usage can be seen in the <a href="../scripts/test-client">client test script</a>. Note that <code>zecale</code> can be invoked from any directory, as long as the Python virtualenv is activated.</p>
<h2>Environment</h2>
<p>Depending on the operation being performed, the <code>zecale</code> client must:</p><ul>
<li>interact with an Ethereum RPC host <b>that supports BW6 arithmetic</b> (e.g. <a href="https://github.com/clearmatics/ganache-cli/tree/v6.10.1-clearmatics">here</a>),</li>
<li>interact with the deployed Zecale contracts,</li>
<li>request proofs and proof verification keys from <code>aggregator-server</code></li>
</ul>
<p>In a similar way as in Zeth, data is stored in files with default file names (which can be overridden on the zecale commands).</p>
<p>The set of files required by Zecale for a single user to interact with a specific deployment is described below.</p>
<ul>
<li><code>eth-address</code> specifies an Ethereum address from which to transactions should be funded. Existing addresses may be copy-pasted into this file.</li>
<li><code>zecale-instance</code> contains the address and ABI for a single instance of the zecale dispatcher contract. This file is created by the deployment step below and should be distributed to each client that will use this instance.</li>
</ul>
<p>Additionally, once the Zecale dispatcher is deployed, Zecale application contracts can be deployed, using the address of the dispatcher. Upon deployment of an application contract, an instance file <code>app-instance</code> will be created.</p>
<h2>Deployment</h2>
<h3>Deploy the Zecale dispatcher</h3>
<p>Deployment compiles and deploys the contracts and initializes them with appropriate data to create a new instance of the Zecale dispatcher. It requires only an <code>eth-address</code> file mentioned above, where the address has sufficient funds.</p>
<div class="fragment"><div class="line"># Create a clean directory for the deployer</div>
<div class="line">(env)$ mkdir deployer</div>
<div class="line">(env)$ cd deployer</div>
<div class="line"> </div>
<div class="line"># Specify an eth-address file for an (unlocked) Ethereum account</div>
<div class="line">(env)$ echo 0x.... &gt; eth-address</div>
<div class="line"> </div>
<div class="line"># Get the verification key</div>
<div class="line">(env)$ zecale get-verification-key</div>
<div class="line"> </div>
<div class="line"># Compile and deploy</div>
<div class="line">(env)$ zecale deploy</div>
<div class="line"> </div>
<div class="line"># Share the instance file with all clients</div>
<div class="line">$ cp zecale-instance &lt;destination&gt;</div>
</div><!-- fragment --><h3>Deploy the Zecale Application</h3>
<p>After deploying the the Zecale dispatcher, it is possible to deploy a Zecale application. One can use the <code>DummyApplication</code> contract as an example:</p>
<div class="fragment"><div class="line">zecale-dummy-app deploy</div>
</div><!-- fragment --><p>For a more comprehensive overview on how to use Zecale with a base application, please refer to the <a href="../scripts/test-zeth-zecale">zeth-zecale integration test script</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jan 5 2022 09:17:53 for Zecale - Reconciling Privacy and Scalability on Smart-Contract Chains by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
